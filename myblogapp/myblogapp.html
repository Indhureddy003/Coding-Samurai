<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Awesome Blog</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
   
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        /* --- NEW: Styles for the modal --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="root"></div>

    <script type="text/babel">
        const API_URL = 'http://localhost:5001';

        // --- NEW: Edit Modal Component ---
        function EditModal({ post, onSave, onCancel }) {
            const [editedTitle, setEditedTitle] = React.useState(post.title);
            const [editedContent, setEditedContent] = React.useState(post.content);

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(post._id, { title: editedTitle, content: editedContent });
            };

            return (
                <div className="modal-overlay">
                    <div className="modal-content">
                        <h2 className="text-2xl font-bold mb-4">Edit Post</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="mb-4">
                                <label htmlFor="edit-title" className="block text-gray-700 font-medium mb-1">Title</label>
                                <input
                                    id="edit-title"
                                    type="text"
                                    value={editedTitle}
                                    onChange={(e) => setEditedTitle(e.target.value)}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                            </div>
                            <div className="mb-6">
                                <label htmlFor="edit-content" className="block text-gray-700 font-medium mb-1">Content</label>
                                <textarea
                                    id="edit-content"
                                    rows="6"
                                    value={editedContent}
                                    onChange={(e) => setEditedContent(e.target.value)}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                ></textarea>
                            </div>
                            <div className="flex justify-end space-x-4">
                                <button type="button" onClick={onCancel} className="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition duration-300">
                                    Cancel
                                </button>
                                <button type="submit" className="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300">
                                    Save Changes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        function App() {
            const [posts, setPosts] = React.useState([]);
            const [title, setTitle] = React.useState('');
            const [content, setContent] = React.useState('');
            const [error, setError] = React.useState(null);
            const [loading, setLoading] = React.useState(true);
            // --- NEW: State for managing the edit modal ---
            const [editingPost, setEditingPost] = React.useState(null);

            React.useEffect(() => {
                fetchPosts();
            }, []);

            const fetchPosts = async () => {
                setError(null);
                setLoading(true);
                try {
                    const response = await fetch(`${API_URL}/posts`);
                    if (!response.ok) throw new Error('Network response was not ok');
                    const data = await response.json();
                    setPosts(data);
                } catch (err) {
                    console.error("Failed to fetch posts:", err);
                    setError("Failed to load posts. Make sure the backend server is running.");
                } finally {
                    setLoading(false);
                }
            };

            const handleAddPost = async (e) => {
                e.preventDefault();
                if (!title.trim() || !content.trim()) {
                    setError("Title and content cannot be empty!");
                    return;
                }
                try {
                    const response = await fetch(`${API_URL}/posts`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ title, content }),
                    });
                    if (!response.ok) throw new Error('Failed to create post');
                    setTitle('');
                    setContent('');
                    setError(null);
                    fetchPosts();
                } catch (err) {
                    console.error("Failed to add post:", err);
                    setError("Failed to add post. Please try again.");
                }
            };

            // --- NEW: Function to handle updating a post ---
            const handleUpdatePost = async (postId, updatedData) => {
                try {
                    const response = await fetch(`${API_URL}/posts/${postId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(updatedData),
                    });
                    if (!response.ok) throw new Error('Failed to update post');
                    setEditingPost(null); // Close the modal
                    fetchPosts(); // Refresh the posts list
                } catch (err) {
                    console.error("Failed to update post:", err);
                    setError("Failed to update post. Please try again.");
                }
            };

            const handleDeletePost = async (postId) => {
                if (!window.confirm("Are you sure you want to delete this post?")) return;
                try {
                    const response = await fetch(`${API_URL}/posts/${postId}`, { method: 'DELETE' });
                    if (!response.ok) throw new Error('Failed to delete post');
                    fetchPosts();
                } catch (err) {
                    console.error("Failed to delete post:", err);
                    setError("Failed to delete post. Please try again.");
                }
            };

            return (
                <div className="container mx-auto p-4 md:p-8 max-w-4xl">
                    {/* --- NEW: Render the modal if a post is being edited --- */}
                    {editingPost && (
                        <EditModal
                            post={editingPost}
                            onSave={handleUpdatePost}
                            onCancel={() => setEditingPost(null)}
                        />
                    )}

                    <header className="text-center mb-12">
                        <h1 className="text-4xl md:text-5xl font-bold text-gray-900">Simple MERN Blog</h1>
                        <p className="text-lg text-gray-600 mt-2">Create, read, update, and delete posts.</p>
                    </header>

                    <div className="bg-white p-6 rounded-xl shadow-md mb-12">
                        <h2 className="text-2xl font-semibold mb-4">Add a New Post</h2>
                        <form onSubmit={handleAddPost}>
                            {/* ... form for adding a post remains the same ... */}
                             <div className="mb-4">
                                <label htmlFor="title" className="block text-gray-700 font-medium mb-1">Title</label>
                                <input type="text" id="title" value={title} onChange={(e) => setTitle(e.target.value)} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Your Post Title" />
                            </div>
                            <div className="mb-4">
                                <label htmlFor="content" className="block text-gray-700 font-medium mb-1">Content</label>
                                <textarea id="content" value={content} onChange={(e) => setContent(e.target.value)} rows="5" className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Write your amazing blog content here..."></textarea>
                            </div>
                            <button type="submit" className="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-300">Add Post</button>
                        </form>
                    </div>

                    <div className="space-y-8">
                        <h2 className="text-3xl font-bold text-center">Blog Feed</h2>
                        {loading && <p className="text-center text-gray-500">Loading posts...</p>}
                        {error && <p className="text-center text-red-500 bg-red-100 p-3 rounded-lg">{error}</p>}
                        {!loading && posts.length === 0 && !error && (
                            <p className="text-center text-gray-500">No posts yet. Be the first to write one!</p>
                        )}

                        {posts.map(post => (
                            <div key={post._id} className="bg-white p-6 rounded-xl shadow-md transition hover:shadow-lg">
                                <div className="flex justify-between items-start">
                                    <div className="flex-grow">
                                        <h3 className="text-2xl font-bold text-gray-900">{post.title}</h3>
                                        <p className="text-sm text-gray-500 mb-4">Posted on: {new Date(post.createdAt).toLocaleDateString()}</p>
                                    </div>
                                    {/* --- NEW: Container for action buttons --- */}
                                    <div className="flex items-center space-x-4">
                                        <button
                                            onClick={() => setEditingPost(post)}
                                            className="text-blue-500 hover:text-blue-700 font-semibold transition duration-200"
                                            title="Edit Post"
                                        >
                                            Edit
                                        </button>
                                        <button
                                            onClick={() => handleDeletePost(post._id)}
                                            className="text-red-500 hover:text-red-700 font-semibold transition duration-200"
                                            title="Delete Post"
                                        >
                                            Delete
                                        </button>
                                    </div>
                                </div>
                                <p className="text-gray-700 whitespace-pre-wrap mt-2">{post.content}</p>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>

</body>
</html>